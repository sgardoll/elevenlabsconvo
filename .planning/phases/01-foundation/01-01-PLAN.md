---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
domain: flutter
---

<objective>
Verify that Phase 1 (Foundation) migration is complete and all components are properly integrated.

Purpose: Confirm the ElevenLabs SDK migration foundation is solid before proceeding to testing.
Output: Verification report documenting current state and any issues found.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@MIGRATION/README.md
@MIGRATION/FILE_STRUCTURE.md
@MIGRATION/QUICK_START.md

@pubspec.yaml
@lib/custom_code/elevenlabs_sdk_service.dart
@lib/custom_code/actions/initialize_conversation_service.dart
@lib/custom_code/widgets/simple_recording_button.dart
@lib/app_state.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify SDK dependency in pubspec.yaml</name>
  <files>pubspec.yaml</files>
  <action>Check that elevenlabs_agents: ^0.3.0 (or compatible version) exists in the dependencies section. Verify no version conflicts.</action>
  <verify>grep -n "elevenlabs_agents" pubspec.yaml returns the dependency line</verify>
  <done>elevenlabs_agents dependency confirmed in pubspec.yaml</done>
</task>

<task type="auto">
  <name>Task 2: Verify elevenlabs_sdk_service.dart exists and is complete</name>
  <files>lib/custom_code/elevenlabs_sdk_service.dart</files>
  <action>Verify the service file exists and contains all required components: ElevenLabsSdkService class, ConversationState enum, initialize() method, toggleRecording(), triggerInterruption(), and state streams. File should be ~490+ lines.</action>
  <verify>wc -l lib/custom_code/elevenlabs_sdk_service.dart shows 450+ lines and contains "class ElevenLabsSdkService"</verify>
  <done>Service file exists with complete implementation</done>
</task>

<task type="auto">
  <name>Task 3: Verify old service file is removed</name>
  <files>lib/custom_code/</files>
  <action>Confirm that conversational_ai_service.dart does NOT exist in lib/custom_code/ or anywhere in the project.</action>
  <verify>find lib/ -name "conversational_ai_service.dart" returns nothing</verify>
  <done>Old service file confirmed removed</done>
</task>

<task type="auto">
  <name>Task 4: Verify actions use new service</name>
  <files>lib/custom_code/actions/initialize_conversation_service.dart</files>
  <action>Check that initialize_conversation_service.dart imports elevenlabs_sdk_service.dart (not conversational_ai_service.dart), uses ElevenLabsSdkService class, and has only 2 parameters (agentId, endpoint).</action>
  <verify>grep "import.*elevenlabs_sdk_service" lib/custom_code/actions/initialize_conversation_service.dart && grep "ElevenLabsSdkService()" lib/custom_code/actions/initialize_conversation_service.dart</verify>
  <done>Actions correctly use new SDK service</done>
</task>

<task type="auto">
  <name>Task 5: Verify widgets use new service</name>
  <files>lib/custom_code/widgets/simple_recording_button.dart</files>
  <action>Check that simple_recording_button.dart imports elevenlabs_sdk_service.dart and uses triggerInterruption() method (not interrupt()).</action>
  <verify>grep "import.*elevenlabs_sdk_service" lib/custom_code/widgets/simple_recording_button.dart && grep "triggerInterruption" lib/custom_code/widgets/simple_recording_button.dart</verify>
  <done>Widgets correctly use new SDK service</done>
</task>

<task type="auto">
  <name>Task 6: Verify App State variables</name>
  <files>lib/app_state.dart</files>
  <action>Confirm all required state variables exist: wsConnectionState (String), isRecording (bool), elevenLabsAgentId (String), endpoint (String), conversationMessages (List). These may be managed via FlutterFlow UI but should exist in the generated app_state.dart.</action>
  <verify>grep -E "(wsConnectionState|elevenLabsAgentId|endpoint|conversationMessages)" lib/app_state.dart | head -10</verify>
  <done>All required App State variables confirmed present</done>
</task>

<task type="auto">
  <name>Task 7: Verify platform permissions</name>
  <files>android/app/src/main/AndroidManifest.xml, ios/Runner/Info.plist</files>
  <action>Check AndroidManifest.xml has BLUETOOTH_SCAN and BLUETOOTH_CONNECT permissions. Check Info.plist has voip in UIBackgroundModes array.</action>
  <verify>grep "BLUETOOTH_SCAN" android/app/src/main/AndroidManifest.xml && grep "voip" ios/Runner/Info.plist</verify>
  <done>Platform permissions confirmed for WebRTC audio</done>
</task>

<task type="auto">
  <name>Task 8: Run static analysis</name>
  <files>lib/</files>
  <action>Run flutter analyze to check for any compilation errors, import issues, or analysis warnings related to the SDK integration.</action>
  <verify>flutter analyze lib/custom_code/ 2>&1 | grep -v "^Analyzing" | head -20</verify>
  <done>Static analysis passes with no critical errors</done>
</task>

</tasks>

<verification>
Before declaring Phase 1 complete:
- [ ] All 8 verification tasks passed
- [ ] SDK dependency confirmed
- [ ] Service file complete and correct
- [ ] No old service file remains
- [ ] Actions and widgets use new service
- [ ] App state variables present
- [ ] Platform permissions configured
- [ ] flutter analyze passes
</verification>

<success_criteria>

- All verification tasks complete
- No blocking issues found
- Phase 1 foundation confirmed solid
- Ready to proceed to Phase 4 (Testing on physical devices)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` with:
- Verification results for each task
- Current state of migration
- Any issues found and their severity
- Recommendation for next steps
</output>
